<!docType HTML>
<html>
<iframe id='yolpoIframe' scrolling='no' style="overflow-y:hidden;border: 0; outline: 0; margin: 0; padding: 0;position: fixed; top: 0; bottom: 0; left: 0; right: 0;width:100%;height:100%;background-color:#fff"></iframe>
<h2 id='divError' style='font-family:sans-serif;position:fixed;top:28%;width:100%;text-align:center;z-index:1;'></h2>

<script src='3rd/esprima.js'></script>
<script src='function.statementify.js'></script>
<script src='function.generateHTMLSnippet.js'></script>
<script>

(function() { // IIFE 
	
	window.onmessage = function(e){
    	sessionStorage.setItem('code',e.data);               // Storing the new code (just sent over by the user typing on the left panel)
    	location.replace('edit.right.html'+location.search); // Requesting to reload the page.
    }
    
    var code = sessionStorage.getItem('code'); 
	if (code==null) {
		return; 
	}
    
	var statements = statementify(code); 
	if (statements.e) {
		// esprima error (parser)
		document.getElementById('divError').style.display ='block';
		document.getElementById('divError').innerHTML = '<br>Parser Error:'+statements.e;
		return;
	}
	document.getElementById('divError').style.display ='none';
	var html = generateHTMLSnippet(statements);
	sessionStorage.setItem('html',html);
	document.getElementById('yolpoIframe').src='proxy.html'+location.search;
}());

</script>
</html>